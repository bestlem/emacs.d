#+TITLE:  Midnight
#+AUTHOR: Mark Bestley
#+EMAIL:  emacs@bestley.co.uk
#+DATE:   26 Jan 2021
#+TAGS:
#+PROPERTY:header-args :cache yes :tangle yes :comments noweb
#+STARTUP: showall

* Midnight mode
:PROPERTIES:
:ID:       org_mark_mini20.local:20210126T142916.732019
:END:
midnight-mode purges buffers which havenâ€™t been displayed in 3 days.
And runs other things on midnight-hook
** Save amx
:PROPERTIES:
:ID:       org_mark_mini20.local:20211030T104455.475471
:END:
The amx file seems not to bne updates as well as it could so lets save it
** Setup
:PROPERTIES:
:ID:       org_mark_mini20.local:20211030T104455.472483
:END:
#+NAME: org_mark_mini20.local_20210126T142916.726975
#+begin_src emacs-lisp
(use-package midnight
  :defer 30
  :config
  (midnight-delay-set 'midnight-delay "06:15")
  (defun add-to-clean-buffer-regex (str)
	(add-to-list 'clean-buffer-list-kill-regexps
				 (rx-to-string `(seq line-start "*" ,str " "))))
  (add-to-clean-buffer-regex "deadgrep")
  (add-to-clean-buffer-regex "helpful")
  (midnight-mode 1)
  (add-hook 'midnight-hook
            (if (bound-and-true-p gcmh-mode)
                #'gcmh-idle-garbage-collect
              #'garbage-collect)
            99)
  ;; (add-hook 'midnight-hook #'garbage-collect 99)
  ;; at end
  (add-hook 'midnight-hook #'amx-save-to-file)
  )
#+end_src
